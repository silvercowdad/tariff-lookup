<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>US Tariff Calculator - Battery ESS</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  padding: 20px;
}
.container {
  max-width: 800px;
  margin: 0 auto;
  background: white;
  border-radius: 16px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  padding: 40px;
}
h1 {
  font-size: 2rem;
  color: #667eea;
  text-align: center;
  margin-bottom: 30px;
}
.form-group {
  margin-bottom: 20px;
}
label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: #444;
}
select {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  font-size: 1rem;
  cursor: pointer;
}
select:focus {
  outline: none;
  border-color: #667eea;
}
.checkbox-group {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 12px;
  padding: 12px;
  background: #f8f9fa;
  border-radius: 8px;
}
.checkbox-group input[type="checkbox"] {
  width: 20px;
  height: 20px;
  cursor: pointer;
}
.checkbox-group label {
  margin: 0;
  font-weight: 500;
  cursor: pointer;
}
button {
  width: 100%;
  padding: 16px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  margin-top: 10px;
}
button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}
.result {
  margin-top: 30px;
  padding: 24px;
  background: #f8f9fa;
  border-radius: 12px;
  border-left: 4px solid #667eea;
}
.result-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 16px;
  border-bottom: 2px solid #dee2e6;
}
.result-title {
  font-size: 1.2rem;
  font-weight: 700;
  color: #333;
}
.total-rate {
  font-size: 2rem;
  font-weight: 800;
  color: #667eea;
}
.tariff-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  margin-bottom: 8px;
  background: white;
  border-radius: 8px;
  border-left: 3px solid #dee2e6;
}
.tariff-item.MFN { border-left-color: #28a745; }
.tariff-item.FTA { border-left-color: #17a2b8; }
.tariff-item.SEC232 { border-left-color: #fd7e14; }
.tariff-item.SEC301 { border-left-color: #dc3545; }
.tariff-item.IEEPA { border-left-color: #6f42c1; }
.tariff-name {
  font-weight: 600;
  color: #333;
  flex: 1;
}
.tariff-rate {
  font-size: 1.2rem;
  font-weight: 700;
  color: #667eea;
  margin-left: 16px;
}
.tariff-tag {
  font-size: 0.75rem;
  padding: 4px 8px;
  border-radius: 4px;
  font-weight: 600;
  text-transform: uppercase;
  margin-left: 12px;
}
.tariff-tag.MFN { background: #d4edda; color: #155724; }
.tariff-tag.FTA { background: #d1ecf1; color: #0c5460; }
.tariff-tag.SEC232 { background: #fff3cd; color: #856404; }
.tariff-tag.SEC301 { background: #f8d7da; color: #721c24; }
.tariff-tag.IEEPA { background: #e2d9f3; color: #4a148c; }
.warnings, .exemptions {
  margin-top: 20px;
  padding: 16px;
  border-radius: 8px;
}
.warnings {
  background: #fff3cd;
  border-left: 4px solid #ffc107;
}
.exemptions {
  background: #d4edda;
  border-left: 4px solid #28a745;
}
.item {
  margin-bottom: 8px;
  font-size: 0.9rem;
  line-height: 1.5;
}
.metadata {
  margin-top: 20px;
  padding-top: 16px;
  border-top: 1px solid #dee2e6;
  font-size: 0.85rem;
  color: #666;
}
.loading {
  text-align: center;
  padding: 20px;
  color: #667eea;
  font-weight: 600;
}
</style>
</head>
<body>

<div class="container">
  <h1>ğŸ”‹ US Tariff Calculator</h1>

  <form id="form">
    <div class="form-group">
      <label for="hsCode">Battery Type</label>
      <select id="hsCode" required>
        <option value="">-- Select Battery Type --</option>
        <option value="8507600010">8507.60.00.10 - EV Batteries (Electric Vehicles)</option>
        <option value="8507600020">8507.60.00.20 - ESS/MPB Batteries (Energy Storage)</option>
      </select>
    </div>

    <div class="form-group">
      <label for="country">Country of Origin</label>
      <select id="country" required>
        <option value="">-- Select Country --</option>
        <option value="CN">ğŸ‡¨ğŸ‡³ China</option>
        <option value="MX">ğŸ‡²ğŸ‡½ Mexico</option>
        <option value="CA">ğŸ‡¨ğŸ‡¦ Canada</option>
        <option value="KR">ğŸ‡°ğŸ‡· South Korea</option>
        <option value="MY">ğŸ‡²ğŸ‡¾ Malaysia</option>
        <option value="VN">ğŸ‡»ğŸ‡³ Vietnam</option>
      </select>
    </div>

    <div class="checkbox-group" id="usmcaGroup" style="display:none;">
      <input type="checkbox" id="usmcaCompliant">
      <label for="usmcaCompliant">
        âœ… USMCA Certificate of Origin (Rules of Origin met)
      </label>
    </div>

    <button type="submit">Calculate Tariff</button>
  </form>

  <div id="result" style="display:none;"></div>
</div>

<script>
const WORKER_URL = 'https://tariff-rules-live.sys1107.workers.dev';

// Country selection handler
document.getElementById('country').addEventListener('change', function() {
  const country = this.value;
  const usmcaGroup = document.getElementById('usmcaGroup');
  
  // Show USMCA checkbox for Mexico and Canada
  if (country === 'MX' || country === 'CA') {
    usmcaGroup.style.display = 'flex';
  } else {
    usmcaGroup.style.display = 'none';
    document.getElementById('usmcaCompliant').checked = false;
  }
});

// Form submission
document.getElementById('form').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const hsCode = document.getElementById('hsCode').value;
  const country = document.getElementById('country').value;
  const usmcaCompliant = document.getElementById('usmcaCompliant').checked;
  
  if (!hsCode || !country) {
    alert('Please select both battery type and country');
    return;
  }
  
  const resultDiv = document.getElementById('result');
  resultDiv.style.display = 'block';
  resultDiv.innerHTML = '<div class="loading">â³ Calculating...</div>';
  
  try {
    const url = `${WORKER_URL}/calculate?hs=${hsCode}&country=${country}&usmca=${usmcaCompliant}`;
    const res = await fetch(url);
    const data = await res.json();
    
    if (data.error) {
      throw new Error(data.error);
    }
    
    displayResult(data);
    
  } catch (err) {
    resultDiv.innerHTML = `
      <div class="result">
        <div style="color: #dc3545; font-weight: 600;">
          âŒ Error: ${err.message}
        </div>
      </div>
    `;
  }
});

function displayResult(data) {
  const resultDiv = document.getElementById('result');
  
  const countryNames = {
    CN: 'ğŸ‡¨ğŸ‡³ China',
    MX: 'ğŸ‡²ğŸ‡½ Mexico',
    CA: 'ğŸ‡¨ğŸ‡¦ Canada',
    KR: 'ğŸ‡°ğŸ‡· South Korea',
    MY: 'ğŸ‡²ğŸ‡¾ Malaysia',
    VN: 'ğŸ‡»ğŸ‡³ Vietnam',
  };
  
  const batteryTypes = {
    '8507600010': 'EV Batteries (Electric Vehicles)',
    '8507600020': 'ESS/MPB Batteries (Energy Storage)',
  };
  
  let html = `
    <div class="result">
      <div class="result-header">
        <div class="result-title">
          ${batteryTypes[data.hsCode] || data.description}<br>
          <small style="font-size:0.8rem;color:#666;">
            HS ${data.hsCode} from ${countryNames[data.country] || data.country}
          </small>
        </div>
        <div class="total-rate">${(data.total * 100).toFixed(1)}%</div>
      </div>
  `;
  
  if (data.items && data.items.length > 0) {
    html += '<div>';
    for (const item of data.items) {
      html += `
        <div class="tariff-item ${item.tag}">
          <div style="flex:1;">
            <div class="tariff-name">âœ“ ${item.name}</div>
          </div>
          <div class="tariff-rate">${(item.rate * 100).toFixed(1)}%</div>
          <div class="tariff-tag ${item.tag}">${item.tag}</div>
        </div>
      `;
    }
    html += '</div>';
  }
  
  if (data.warnings && data.warnings.length > 0) {
    html += '<div class="warnings">';
    for (const w of data.warnings) {
      html += `<div class="item">${w}</div>`;
    }
    html += '</div>';
  }
  
  if (data.exemptions && data.exemptions.length > 0) {
    html += '<div class="exemptions">';
    for (const e of data.exemptions) {
      html += `<div class="item">${e}</div>`;
    }
    html += '</div>';
  }
  
  if (data.metadata) {
    html += `
      <div class="metadata">
        <div style="display:flex; justify-content:space-between; margin-bottom:6px;">
          <span><strong>Calculated At:</strong></span>
          <span>${new Date(data.metadata.calculatedAt).toLocaleString()}</span>
        </div>
        <div style="display:flex; justify-content:space-between;">
          <span><strong>Rules Version:</strong></span>
          <span>${data.metadata.rulesVersion}</span>
        </div>
      </div>
    `;
  }
  
  html += '</div>';
  resultDiv.innerHTML = html;
  resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}
</script>
window.addEventListener('DOMContentLoaded', async function() {
  try {
    const res = await fetch('https://tariff-rules-live.sys1107.workers.dev/check-updates');
    const data = await res.json();
    
    if (data.hasUpdate) {
      const timestamp = new Date(data.timestamp).toLocaleString('ko-KR', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit'
      });
      
      const banner = document.createElement('div');
      banner.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
        color: white;
        padding: 15px 20px;
        text-align: center;
        z-index: 9999;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        animation: slideDown 0.4s ease-out;
      `;
      
      banner.innerHTML = `
        <div style="max-width: 1200px; margin: 0 auto; display: flex; align-items: center; justify-content: center; gap: 20px; flex-wrap: wrap;">
          <strong style="font-size: 16px;">ğŸš¨ Reed Smith ì—…ë°ì´íŠ¸ ê°ì§€!</strong>
          <span style="font-size: 14px; opacity: 0.9;">ë³€ê²½: ${timestamp}</span>
          <div style="display: flex; gap: 10px;">
            <button onclick="window.open('https://www.tradecompliance.reedsmith.com/trump-2-0-tariff-tracker', '_blank')" 
                    style="background: white; color: #ff6b6b; border: none; padding: 8px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px;">
              ğŸ“„ í˜ì´ì§€ ì—´ê¸°
            </button>
            <button onclick="alert('Reed Smith í˜ì´ì§€ì—ì„œ\\në¶ë§ˆí¬ ë°”ì˜ ğŸ“Š Extract Tariffs í´ë¦­!')" 
                    style="background: rgba(255,255,255,0.2); color: white; border: 1px solid white; padding: 8px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px;">
              ğŸ“Š ì‚¬ìš©ë²•
            </button>
            <button onclick="this.closest('div').parentElement.parentElement.remove(); document.body.style.paddingTop = '0'" 
                    style="background: transparent; color: white; border: 1px solid white; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
              âœ•
            </button>
          </div>
        </div>
      `;
      
      document.body.insertBefore(banner, document.body.firstChild);
      document.body.style.paddingTop = '80px';
      
      if (Notification.permission === "granted") {
        new Notification("ğŸš¨ ê´€ì„¸ ì—…ë°ì´íŠ¸!", {
          body: `Reed Smith ë³€ê²½ ê°ì§€\n${timestamp}`,
          icon: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='75' font-size='75'>ğŸš¨</text></svg>",
          requireInteraction: true
        });
      } else if (Notification.permission !== "denied") {
        Notification.requestPermission();
      }
    }
  } catch (err) {
    console.error('Update check failed:', err);
  }
});

const style = document.createElement('style');
style.textContent = `
  @keyframes slideDown {
    from { transform: translateY(-100%); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }
`;
document.head.appendChild(style);
</script>

</body>
</html>
```

---

## **ğŸš€ ë°°í¬ ìˆœì„œ**

1. **Cloudflare Worker ë°°í¬**
   - ìœ„ Worker ì½”ë“œ ë³µì‚¬
   - Cloudflare Dashboard â†’ Workers â†’ Edit
   - Save and Deploy

2. **Admin Update ì‹¤í–‰**
```
   https://tariff-rules-live.sys1107.workers.dev/admin/update?token=YOUR_TOKEN

